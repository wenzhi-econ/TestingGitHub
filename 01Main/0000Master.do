/* 
This is the master do file for the project. 
It includes the following code blocks:
    specify default setups, e.g., Stata version to be used 
    create global macros to store paths of different folders
    ensure that executed user-written packages from the local library
    set figure scheme 
    execute do files used to replicate output used in the paper 
    (the dofile-output mapping is in the _Description.md file) 
        run do files for data cleaning 
        run do files for all results related to event studies 
        run do files for figures and tables in the paper 
        run do files for appendix figures and tables in the paper 
        run do files for calculating statistics cited in the paper

RA: WWZ 
Time: 2025-02-25
*/

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? default setups
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

version 16

clear all
set more off
set maxvar 32767
set varabbrev off

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? global macros to store folder paths
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

if	"`c(username)'" == "wang" {
    global user "E:/__RA/02MANAGERS"
}

if	"`c(username)'" == "wenzhi0" {
    //&? This is the path specified for usage on Booth high-performance computing cluster, Mercury.
    //&? Packages need to be installed when connecting to the server's Stata.
    global user "/home/wenzhi0/JMP"
    ssc install grstyle, replace
    ssc install palettes, replace

    ssc install colrspace, replace
    ssc install schemepack, replace
    ssc install ftools, replace
    ssc install reghdfe, replace
    ssc install xlincom, replace
    ssc install coefplot, replace
    ssc install estout, replace
    ssc install ppmlhdfe, replace
}

if  "`c(username)'" =="virginiaminni" {
    global user "/Users/virginiaminni/Dropbox/JMP_Managers"
}

if 	"`c(username)'" == "virginia_m"   {		
    global user = "C:/Users/virginia_m/Dropbox/JMP_Managers"
}

if  "`c(username)'" == "RA" global user = "C:/Users/RA"

cd "${user}"

* Paper Managers folder
global Paper        "${user}/Paper Managers"
global DoFiles      "${user}/Paper Managers/DoFiles"
global Results      "${user}/Paper Managers/Results"

global FinalData    "${user}/Paper Managers/Data"
global RawMNEData   "${user}/Paper Managers/Data/01RawData/01MNEData"
global RawONETData  "${user}/Paper Managers/Data/01RawData/02ONET"
global RawCntyData  "${user}/Paper Managers/Data/01RawData/03Country"
global TempData     "${user}/Paper Managers/Data/02TempData"

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? libraries (user-written procedures) to be used 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? install all necessary packages to a local directory
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
/* 
This code block installs necessary community-contributed packages to a directory in the project folder.
The codes are often commented out after the first run to avoid reinstallation.
Date installed: 2025-02-25
*/

/* capture mkdir "${DoFiles}/Libraries"
net set ado "${DoFiles}/Libraries"

foreach pkg in ftools reghdfe ppmlhdfe xlincom estout coefplot grstyle palettes colrspace schemepack {
    local website_folder = substr("`pkg'", 1, 1)
    net from "http://fmwww.bc.edu/repec/bocode/`website_folder'"
    net install `pkg', replace
} */

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? using libraries stored in the local folder
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

net set ado "${DoFiles}/Libraries"

tokenize `"$S_ADO"', parse(";")
while `"`1'"' != "" {
    if `"`1'"'!="BASE" capture adopath - `"`1'"'
    macro shift
}
adopath ++ "${DoFiles}/Libraries"

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? set figure scheme 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

/* set scheme white_tableau */
grstyle init white_tableau, path("${DoFiles}/Libraries") replace
grstyle set plain, horizontal grid

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? main programs 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? dataset construction
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

/* capture log close 
log using "${Results}/001DataCleaning/logfile_20250113_DataConstruction", replace text

do "${DoFiles}/01Main/0101GenerateWorkerOutcomes.do"
do "${DoFiles}/01Main/0102HFMeasure.do"
do "${DoFiles}/01Main/0103GenerateEventDummies.do"
do "${DoFiles}/01Main/0104GenerateHeterogeneityIndicators.do"
do "${DoFiles}/01Main/0105SalesProductivityDatasets.do"
do "${DoFiles}/01Main/0106TeamLevelDataset.do"

//&? It takes around 15 min to create all the main datasets used in the paper.
log close */

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? event studies 
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

*!! quarterly aggregation programs
do "${DoFiles}/01Main/0201CoefPrograms_LHminusLL.do" 
do "${DoFiles}/01Main/0202CoefPrograms_HLminusHH.do"
do "${DoFiles}/01Main/0203CoefPrograms_Dual_TestingforAsymmetries.do"
do "${DoFiles}/01Main/0204CoefPrograms_LHminusLL_OnlyPost.do" 
do "${DoFiles}/01Main/0205CoefPrograms_HLminusHH_OnlyPost.do"
do "${DoFiles}/01Main/0206CoefPrograms_Dual_TestingforAsymmetries_OnlyPost.do"
do "${DoFiles}/01Main/0207CoefPrograms_CohortDynamics.do"


*!! event study regressions 
/* do "${DoFiles}/01Main/0301_01TwoMainOutcomesInEventStudies.do"
do "${DoFiles}/01Main/0301_02PayOutcomesInEventStudies.do"
do "${DoFiles}/01Main/0301_03WLPromotionsInEventStudies.do"
do "${DoFiles}/01Main/0301_04ONETInEventStudies_EarlyAgeM.do"
do "${DoFiles}/01Main/0301_05ProbLateralTransferInEventStudies_EarlyAgeM.do"
do "${DoFiles}/01Main/0302_01Decomp_TransferSJC.do"
do "${DoFiles}/01Main/0302_02Decomp_PromWL.do" */

*!! exit results 
/* do "${DoFiles}/01Main/0304_01ExitOutcomes_CrossSection.do" */
/* do "${DoFiles}/01Main/0304_02ExitOutcomes_DiffTypes.do" */

*!! heterogeneity table 
/* do "${DoFiles}/01Main/0303HeterogeneityOnMainOutcomes.do" */

*!! exploration of more heterogeneity results 
/* do "${DoFiles}/03Exploration/02Heterogeneity/030208_01HeteroByFirstMngrDuration_Gains.do" */
/* do "${DoFiles}/03Exploration/02Heterogeneity/030208_02HeteroByFirstMngrDuration_Loss.do" */

